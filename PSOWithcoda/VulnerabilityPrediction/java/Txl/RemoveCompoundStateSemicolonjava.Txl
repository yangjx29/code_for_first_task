% Txl v10.8 (7.5.20) (c) 1988-2020 Queen's University at Kingston
% 这个文件主要是为了删除compound_statement里面的semicolon

include "java.grm"

function main
    replace [package_declaration]
        P [package_declaration]
    by
        P [removeSemicolon] 
end function

function removeSemicolon
    replace [package_declaration]
        P [package_declaration]
    construct CS [repeat block] % Java uses [block] instead of [compound_statement]
        _ [^ P]
    construct NCS [repeat block]
        _ [deleteSemicolon each CS]
    by 
        P [replaceCS each CS NCS]
end function

function replaceCS Old [block] New [block]
    replace *[block]
        Old
    by
        New
end function

function deleteSemicolon CS [block]
    replace [repeat block]
        RCS [repeat block]
    construct NCS [block]
        CS [isNeedChanged]
    by
        RCS [. NCS]
end function

% 这里判断是否需要改变
function isNeedChanged
    replace [block]
        CS [block]
    deconstruct CS 
        '{ RS [repeat declaration_or_statement] '} % Java block content
        Sei [opt ';] % Optional trailing semicolon
    construct NCS [block]
        '{ RS '}' % Remove trailing semicolon
    by
        NCS
end function